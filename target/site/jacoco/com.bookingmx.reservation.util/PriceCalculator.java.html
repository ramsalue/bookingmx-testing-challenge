<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PriceCalculator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bookingmx-testing-challenge</a> &gt; <a href="index.source.html" class="el_package">com.bookingmx.reservation.util</a> &gt; <span class="el_source">PriceCalculator.java</span></div><h1>PriceCalculator.java</h1><pre class="source lang-java linenums">package com.bookingmx.reservation.util;

import com.bookingmx.reservation.model.RoomType;
import java.time.LocalDate;

/**
 * Utility class for calculating prices in the reservation system.
 * This class handles all price-related calculations including base prices,
 * discounts for extended stays, taxes, and final totals.
 *
 * All methods are static and the class cannot be instantiated.
 *
 * Business Rules:
 * - 7-13 nights: 5% discount
 * - 14-29 nights: 10% discount
 * - 30+ nights: 15% discount
 * - Tax rate: 16% (standard hotel tax)
 *
 * @author BookingMx Development Team
 * @version 1.0.0
 */
public class PriceCalculator {

    /**
     * Tax rate applied to all reservations (16% as decimal).
     */
    public static final double TAX_RATE = 0.16;

    /**
     * Minimum nights for first discount tier (5% off).
     */
    public static final int DISCOUNT_TIER_1_NIGHTS = 7;

    /**
     * Discount percentage for tier 1 (7-13 nights).
     */
    public static final double DISCOUNT_TIER_1_RATE = 0.05;

    /**
     * Minimum nights for second discount tier (10% off).
     */
    public static final int DISCOUNT_TIER_2_NIGHTS = 14;

    /**
     * Discount percentage for tier 2 (14-29 nights).
     */
    public static final double DISCOUNT_TIER_2_RATE = 0.10;

    /**
     * Minimum nights for third discount tier (15% off).
     */
    public static final int DISCOUNT_TIER_3_NIGHTS = 30;

    /**
     * Discount percentage for tier 3 (30+ nights).
     */
    public static final double DISCOUNT_TIER_3_RATE = 0.15;

    /**
     * Private constructor to prevent instantiation.
     * This class should only be used through its static methods.
     */
<span class="fc" id="L63">    private PriceCalculator() {</span>
<span class="fc" id="L64">        throw new UnsupportedOperationException(&quot;PriceCalculator is a utility class and cannot be instantiated&quot;);</span>
    }

    /**
     * Calculates the base price for a reservation without any discounts or taxes.
     * Base price = room base price per night Ã— number of nights
     *
     * @param roomType the type of room being reserved
     * @param numberOfNights the number of nights for the stay
     * @return the base price before discounts and taxes
     * @throws IllegalArgumentException if roomType is null or numberOfNights is negative
     */
    public static double calculateBasePrice(RoomType roomType, long numberOfNights) {
<span class="fc bfc" id="L77" title="All 2 branches covered.">        if (roomType == null) {</span>
<span class="fc" id="L78">            throw new IllegalArgumentException(&quot;Room type cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L80" title="All 2 branches covered.">        if (numberOfNights &lt; 0) {</span>
<span class="fc" id="L81">            throw new IllegalArgumentException(&quot;Number of nights cannot be negative&quot;);</span>
        }

<span class="fc" id="L84">        return roomType.getBasePrice() * numberOfNights;</span>
    }

    /**
     * Calculates the base price using check-in and check-out dates.
     *
     * @param roomType the type of room being reserved
     * @param checkInDate the check-in date
     * @param checkOutDate the check-out date
     * @return the base price before discounts and taxes
     * @throws IllegalArgumentException if any parameter is null or dates are invalid
     */
    public static double calculateBasePrice(RoomType roomType, LocalDate checkInDate, LocalDate checkOutDate) {
<span class="pc bpc" id="L97" title="1 of 2 branches missed.">        if (roomType == null) {</span>
<span class="nc" id="L98">            throw new IllegalArgumentException(&quot;Room type cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L100" title="All 4 branches covered.">        if (checkInDate == null || checkOutDate == null) {</span>
<span class="fc" id="L101">            throw new IllegalArgumentException(&quot;Dates cannot be null&quot;);</span>
        }

<span class="fc" id="L104">        long nights = DateValidator.calculateNights(checkInDate, checkOutDate);</span>
<span class="fc" id="L105">        return calculateBasePrice(roomType, nights);</span>
    }

    /**
     * Determines the applicable discount rate based on the number of nights.
     *
     * Discount tiers:
     * - 1-6 nights: 0% (no discount)
     * - 7-13 nights: 5% discount
     * - 14-29 nights: 10% discount
     * - 30+ nights: 15% discount
     *
     * @param numberOfNights the number of nights for the stay
     * @return the discount rate as a decimal (0.0 to 0.15)
     * @throws IllegalArgumentException if numberOfNights is negative
     */
    public static double getDiscountRate(long numberOfNights) {
<span class="fc bfc" id="L122" title="All 2 branches covered.">        if (numberOfNights &lt; 0) {</span>
<span class="fc" id="L123">            throw new IllegalArgumentException(&quot;Number of nights cannot be negative&quot;);</span>
        }

<span class="fc bfc" id="L126" title="All 2 branches covered.">        if (numberOfNights &gt;= DISCOUNT_TIER_3_NIGHTS) {</span>
<span class="fc" id="L127">            return DISCOUNT_TIER_3_RATE;</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">        } else if (numberOfNights &gt;= DISCOUNT_TIER_2_NIGHTS) {</span>
<span class="fc" id="L129">            return DISCOUNT_TIER_2_RATE;</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">        } else if (numberOfNights &gt;= DISCOUNT_TIER_1_NIGHTS) {</span>
<span class="fc" id="L131">            return DISCOUNT_TIER_1_RATE;</span>
        } else {
<span class="fc" id="L133">            return 0.0; // No discount for stays less than 7 nights</span>
        }
    }

    /**
     * Calculates the discount amount based on base price and number of nights.
     *
     * @param basePrice the base price before discount
     * @param numberOfNights the number of nights for the stay
     * @return the discount amount to be subtracted from base price
     * @throws IllegalArgumentException if basePrice is negative or numberOfNights is negative
     */
    public static double calculateDiscount(double basePrice, long numberOfNights) {
<span class="fc bfc" id="L146" title="All 2 branches covered.">        if (basePrice &lt; 0) {</span>
<span class="fc" id="L147">            throw new IllegalArgumentException(&quot;Base price cannot be negative&quot;);</span>
        }
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        if (numberOfNights &lt; 0) {</span>
<span class="nc" id="L150">            throw new IllegalArgumentException(&quot;Number of nights cannot be negative&quot;);</span>
        }

<span class="fc" id="L153">        double discountRate = getDiscountRate(numberOfNights);</span>
<span class="fc" id="L154">        return basePrice * discountRate;</span>
    }

    /**
     * Calculates the price after applying discount but before tax.
     *
     * @param roomType the type of room being reserved
     * @param numberOfNights the number of nights for the stay
     * @return the price after discount, before tax
     * @throws IllegalArgumentException if roomType is null or numberOfNights is negative
     */
    public static double calculatePriceAfterDiscount(RoomType roomType, long numberOfNights) {
<span class="fc" id="L166">        double basePrice = calculateBasePrice(roomType, numberOfNights);</span>
<span class="fc" id="L167">        double discount = calculateDiscount(basePrice, numberOfNights);</span>
<span class="fc" id="L168">        return basePrice - discount;</span>
    }

    /**
     * Calculates the tax amount based on a given price.
     *
     * @param price the price on which to calculate tax
     * @return the tax amount
     * @throws IllegalArgumentException if price is negative
     */
    public static double calculateTax(double price) {
<span class="fc bfc" id="L179" title="All 2 branches covered.">        if (price &lt; 0) {</span>
<span class="fc" id="L180">            throw new IllegalArgumentException(&quot;Price cannot be negative&quot;);</span>
        }

<span class="fc" id="L183">        return price * TAX_RATE;</span>
    }

    /**
     * Calculates the total price including discount and tax.
     * This is the final price the customer will pay.
     *
     * Formula: (base price - discount) + tax on discounted price
     *
     * @param roomType the type of room being reserved
     * @param numberOfNights the number of nights for the stay
     * @param includeTax whether to include tax in the calculation
     * @return the total final price
     * @throws IllegalArgumentException if roomType is null or numberOfNights is negative
     */
    public static double calculateTotalPrice(RoomType roomType, long numberOfNights, boolean includeTax) {
<span class="fc bfc" id="L199" title="All 2 branches covered.">        if (roomType == null) {</span>
<span class="fc" id="L200">            throw new IllegalArgumentException(&quot;Room type cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">        if (numberOfNights &lt; 0) {</span>
<span class="nc" id="L203">            throw new IllegalArgumentException(&quot;Number of nights cannot be negative&quot;);</span>
        }

<span class="fc" id="L206">        double priceAfterDiscount = calculatePriceAfterDiscount(roomType, numberOfNights);</span>

<span class="fc bfc" id="L208" title="All 2 branches covered.">        if (includeTax) {</span>
<span class="fc" id="L209">            double tax = calculateTax(priceAfterDiscount);</span>
<span class="fc" id="L210">            return priceAfterDiscount + tax;</span>
        }

<span class="fc" id="L213">        return priceAfterDiscount;</span>
    }

    /**
     * Calculates the total price including discount and tax (convenience method).
     * By default includes tax.
     *
     * @param roomType the type of room being reserved
     * @param numberOfNights the number of nights for the stay
     * @return the total final price including tax
     * @throws IllegalArgumentException if roomType is null or numberOfNights is negative
     */
    public static double calculateTotalPrice(RoomType roomType, long numberOfNights) {
<span class="fc" id="L226">        return calculateTotalPrice(roomType, numberOfNights, true);</span>
    }

    /**
     * Calculates the total price using check-in and check-out dates.
     *
     * @param roomType the type of room being reserved
     * @param checkInDate the check-in date
     * @param checkOutDate the check-out date
     * @param includeTax whether to include tax in the calculation
     * @return the total final price
     * @throws IllegalArgumentException if any parameter is null or dates are invalid
     */
    public static double calculateTotalPrice(RoomType roomType, LocalDate checkInDate,
                                             LocalDate checkOutDate, boolean includeTax) {
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">        if (roomType == null) {</span>
<span class="nc" id="L242">            throw new IllegalArgumentException(&quot;Room type cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L244" title="All 4 branches covered.">        if (checkInDate == null || checkOutDate == null) {</span>
<span class="fc" id="L245">            throw new IllegalArgumentException(&quot;Dates cannot be null&quot;);</span>
        }

<span class="fc" id="L248">        long nights = DateValidator.calculateNights(checkInDate, checkOutDate);</span>
<span class="fc" id="L249">        return calculateTotalPrice(roomType, nights, includeTax);</span>
    }

    /**
     * Calculates the total price using dates, including tax by default.
     *
     * @param roomType the type of room being reserved
     * @param checkInDate the check-in date
     * @param checkOutDate the check-out date
     * @return the total final price including tax
     * @throws IllegalArgumentException if any parameter is null or dates are invalid
     */
    public static double calculateTotalPrice(RoomType roomType, LocalDate checkInDate, LocalDate checkOutDate) {
<span class="fc" id="L262">        return calculateTotalPrice(roomType, checkInDate, checkOutDate, true);</span>
    }

    /**
     * Gets a breakdown of the price calculation showing all components.
     * Useful for displaying itemized pricing to customers.
     *
     * @param roomType the type of room being reserved
     * @param numberOfNights the number of nights for the stay
     * @return a PriceBreakdown object containing all price components
     * @throws IllegalArgumentException if roomType is null or numberOfNights is negative
     */
    public static PriceBreakdown getPriceBreakdown(RoomType roomType, long numberOfNights) {
<span class="fc bfc" id="L275" title="All 2 branches covered.">        if (roomType == null) {</span>
<span class="fc" id="L276">            throw new IllegalArgumentException(&quot;Room type cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L278" title="All 2 branches covered.">        if (numberOfNights &lt; 0) {</span>
<span class="fc" id="L279">            throw new IllegalArgumentException(&quot;Number of nights cannot be negative&quot;);</span>
        }

<span class="fc" id="L282">        double basePrice = calculateBasePrice(roomType, numberOfNights);</span>
<span class="fc" id="L283">        double discountRate = getDiscountRate(numberOfNights);</span>
<span class="fc" id="L284">        double discountAmount = calculateDiscount(basePrice, numberOfNights);</span>
<span class="fc" id="L285">        double priceAfterDiscount = basePrice - discountAmount;</span>
<span class="fc" id="L286">        double tax = calculateTax(priceAfterDiscount);</span>
<span class="fc" id="L287">        double totalPrice = priceAfterDiscount + tax;</span>

<span class="fc" id="L289">        return new PriceBreakdown(basePrice, discountRate, discountAmount,</span>
                priceAfterDiscount, tax, totalPrice);
    }

    /**
     * Formats a price as a currency string with two decimal places.
     *
     * @param price the price to format
     * @return formatted price string (e.g., &quot;$150.00&quot;)
     */
    public static String formatPrice(double price) {
<span class="fc" id="L300">        return String.format(&quot;$%.2f&quot;, price);</span>
    }

    /**
     * Inner class to represent a detailed breakdown of price components.
     * This provides transparency to customers about how the final price is calculated.
     */
    public static class PriceBreakdown {
        private final double basePrice;
        private final double discountRate;
        private final double discountAmount;
        private final double priceAfterDiscount;
        private final double tax;
        private final double totalPrice;

        /**
         * Constructor for PriceBreakdown.
         *
         * @param basePrice the base price before any adjustments
         * @param discountRate the discount rate applied (as decimal)
         * @param discountAmount the dollar amount of discount
         * @param priceAfterDiscount the price after discount but before tax
         * @param tax the tax amount
         * @param totalPrice the final total price
         */
        public PriceBreakdown(double basePrice, double discountRate, double discountAmount,
<span class="fc" id="L326">                              double priceAfterDiscount, double tax, double totalPrice) {</span>
<span class="fc" id="L327">            this.basePrice = basePrice;</span>
<span class="fc" id="L328">            this.discountRate = discountRate;</span>
<span class="fc" id="L329">            this.discountAmount = discountAmount;</span>
<span class="fc" id="L330">            this.priceAfterDiscount = priceAfterDiscount;</span>
<span class="fc" id="L331">            this.tax = tax;</span>
<span class="fc" id="L332">            this.totalPrice = totalPrice;</span>
<span class="fc" id="L333">        }</span>

        public double getBasePrice() {
<span class="fc" id="L336">            return basePrice;</span>
        }

        public double getDiscountRate() {
<span class="fc" id="L340">            return discountRate;</span>
        }

        public double getDiscountAmount() {
<span class="fc" id="L344">            return discountAmount;</span>
        }

        public double getPriceAfterDiscount() {
<span class="fc" id="L348">            return priceAfterDiscount;</span>
        }

        public double getTax() {
<span class="fc" id="L352">            return tax;</span>
        }

        public double getTotalPrice() {
<span class="fc" id="L356">            return totalPrice;</span>
        }

        /**
         * Returns a formatted string representation of the price breakdown.
         *
         * @return formatted breakdown string
         */
        @Override
        public String toString() {
<span class="fc" id="L366">            StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L367">            sb.append(&quot;Price Breakdown:\n&quot;);</span>
<span class="fc" id="L368">            sb.append(String.format(&quot;  Base Price:         %s\n&quot;, formatPrice(basePrice)));</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">            if (discountRate &gt; 0) {</span>
<span class="nc" id="L370">                sb.append(String.format(&quot;  Discount (%.0f%%):     -%s\n&quot;,</span>
<span class="nc" id="L371">                        discountRate * 100, formatPrice(discountAmount)));</span>
<span class="nc" id="L372">                sb.append(String.format(&quot;  Subtotal:           %s\n&quot;, formatPrice(priceAfterDiscount)));</span>
            }
<span class="fc" id="L374">            sb.append(String.format(&quot;  Tax (%.0f%%):          %s\n&quot;, TAX_RATE * 100, formatPrice(tax)));</span>
<span class="fc" id="L375">            sb.append(String.format(&quot;  Total:              %s\n&quot;, formatPrice(totalPrice)));</span>
<span class="fc" id="L376">            return sb.toString();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>